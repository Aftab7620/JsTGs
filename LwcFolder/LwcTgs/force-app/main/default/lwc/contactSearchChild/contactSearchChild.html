<template>
    <!-- Datatable -->
    <lightning-layout multiple-rows>
        <lightning-layout-item size="12">
            <lightning-datatable 
                key-field="Id"
                data={contacts}
                columns={columns}
                onrowaction={handleRowAction}>
            </lightning-datatable>
        </lightning-layout-item>
    </lightning-layout>

    <!-- Modal -->
    <template if:true={showModal}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <lightning-layout multiple-rows class="slds-modal__container">
                
                <!-- Header -->
                <lightning-layout-item size="12" class="slds-modal__header">
                    <h2 class="slds-text-heading_medium">Contact Details</h2>
                </lightning-layout-item>

                <!-- Content: Edit Form + File Upload -->
                <lightning-layout-item size="12" class="slds-modal__content slds-p-around_medium">

                    <!-- Record Edit Form -->
                    <lightning-record-edit-form 
                        object-api-name="Contact"
                        record-id={selectedContactId}
                        onsuccess={handleSave}>
                        
                        <lightning-messages></lightning-messages>
                        <lightning-input-field field-name="FirstName"></lightning-input-field>
                        <lightning-input-field field-name="LastName"></lightning-input-field>
                        <lightning-input-field field-name="Email"></lightning-input-field>
                        <lightning-input-field field-name="Phone"></lightning-input-field>
                        <lightning-input-field field-name="AccountId"></lightning-input-field>

                        <lightning-layout multiple-rows class="slds-m-top_small">
                            <lightning-layout-item size="12">
                                <lightning-button 
                                    type="submit" 
                                    label="Save Contact" 
                                    variant="brand">
                                </lightning-button>
                            </lightning-layout-item>
                        </lightning-layout>
                    </lightning-record-edit-form>

                    <!-- File Upload Section -->
                    <lightning-layout multiple-rows class="slds-m-top_medium">
                        <lightning-layout-item size="12">
                            <lightning-file-upload
                                label="Upload Files for this Contact"
                                name="fileUploader"
                                record-id={selectedContactId}
                                accept={acceptedFormats}
                                onuploadfinished={handleUploadFinished}>
                            </lightning-file-upload>
                        </lightning-layout-item>
                    </lightning-layout>

                </lightning-layout-item>

                <!-- Footer -->
                <lightning-layout-item size="12" class="slds-modal__footer">
                    <lightning-button 
                        label="Close" 
                        onclick={closeModal}>
                    </lightning-button>
                </lightning-layout-item>
            
            </lightning-layout>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
</template>
